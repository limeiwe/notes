


Day 8 网络编程



为何要学网络编程
	1. 掌握互联网协议基本原理，掌握 各种应用的工作机制，http,smtp ,dns ,ftp 抖音、微信
	2. 掌握开发一个c/s架构 的 联网软件的能力

因特网起源&发展
	最早的计算机是不能连网的
	1969 年， 4点连接 ，军方网
	1970年代+ , IBM, HP , DEC, \
	ISO ， 1981 OSI 七层模型  ， 每层有自己的作用，  


	ibm sna , dec dna , 	

	1974, tcp/ip 互联网协议模型， eu --\\\\\\\-> us   9.4w . 

	tcp / ip 已经成为事实的互联 网协议 标准。 


tcp/ip 各层作用基本介绍

一条消息是怎么发到对方电脑上的？ 
	 i miss u 
	 邮信： 
	 1. 装信封——》 tcp包首
	 2. 信封——》地址，邮编， ip包首
	 3. 邮票+邮局章， 以太网包


	 拆信：
	 1. 对方所住所附近邮局
	 2. 邮弟员送到你手里
	 3. 打开信封


tcp/ip 封包解包过程剖析 


tcp/ip 模型各层介绍 
	物理层
		传递2进制电信号的介质 

	链路层
		单纯传递01010没有意义 ，必须标识每组电信号特征。 然后分组按顺序发出去。 

		以太网协议 ，一组电信号就是一个数据包，一个数据包又称为一帧。 
		46-1500字节，一个数据包最多1500个字节 
		包首固定14个字节， mac目标地址，源地址，

		Mac地址  00:0e:c6:cc:5b:46  相当于现实生活中的身份证信息， 标识全世界每台电脑的唯一地址
		mac 地址的作用？ 
			唯一 标识每台电脑 ， 

		消息怎么真正的发给对方呢？	
			在一个局域网里，通信 靠吼(广播)，所有连接到交换机的设备，都可以收到消息， 然后它们会解包这个消息，检查包头里的目标mac地址，如果不是找自己的，就丢弃。 

			黑姑娘收到消息，会处理消息。 

			流量浪费， 网络拥堵。 广播风暴

			解决方案： 
			1. 每个人先做一个自我介绍 （广播 ）
			2. 班委记录下每个人的信息 （小本本上）
			3. 以后，再找人， 先找班委， 班委查一下小本本，告诉对方这个人在哪

			交换机： 
			mac地址表，存着本网络所有电脑的mac地址
			通信变成了单播


		网络层
			路由器
				对不同网络进行隔离，防止广播风暴，
				不同网络之间的数据转发

				路由器要实现不同网络数据转发的功能 ，就必须知道所有人的mac地址

				00:0e:c6:cc:5b:42
				00:0e:c6:cc:5b:43
				00:0e:c6:cc:5b:45

			IP 地址 		192.168.	11.	  4  住址
				   		山东省.德州。城后李。87号	
			mac 身份证号

			IPv4 地址构成 规则 
				ip 地址是一个32位bit构成 的地址， 4个字节 ， 用4个10进制数来表示， 每个字节 用.隔开

				只要想上网就需要ip 的地址，

				0.0.0.0 - 255.255.255.255 

				2**8 = 256 ,
				一共有多少个ip地址呢？ 
				2**32 = 43亿 个IP v4地址

				中国一共有3.38亿个ipv4, 根本不够所有中国人一起上网的
				为了解决ip 地址不够用的问题，科学家搞出了2个方案： 
				1. 研发出了ip v6, 128bit, 2**128, 地球上每一粒尘埃都可以分配到一个地址. 
				2. 通过NAT端口映射技术实现了IP 共享 。 ip +端口， 

		    ip 地址的网络位和 主机位。 
		    网络位是用来标识网段的--》192.168.11.0 一个网段
		    主机位是用来表示具体主机的 4 是主机位，
		    	192.168.11.0 网段， 包含的主机，2**8=256， 
		    	但是0不能用，255也不能用，（广播地址）， 1-254，

		    	192.168.1.255 

		    ip 地址分类： 
		    	ABCDE

		    	在局域网，只能配置私有地址
		    	要上网，必须 有公有地址，除了私有地址之外的，都叫公有地址。 

		    	有一个特殊B类地址段是169.254.x.x ， 你没获取到合法ip, 你是不能上网

		    属于同一个网段的，就叫本地网络。 不在同一个网段，就叫远程 网络 。 
		    
		子网掩码的作用&划分 
		   作用： 
		   	  1. 划分子网，减少IP地址浪费
		   	  2. 减小广播风暴范围
		
			你们要上网：
				A 100人 193.100.100.0  1-254 
				B 300人 193.100.101.0  

			实际情况 ： 
				A : 193.100.100.180-185 
				B : 193.100.100.193-200 
				发一个广播 ，你这个网段的所有主机都能收到
				A 中病毒了， B公司跟着遭殃 

			解决这个问题的思路，是确保AB真正的不在一个网段、
			子网划分
				A 193.100.100.100 
				  255.255.255.128 
				B 193.100.100.130 
				  255.255.255.128 


			子网掩码
			   标识一个ip的所处的网段
			子网掩码如何区分2个ip是不是在同一个网段？ 
				拿2个ip分别跟子网掩码做与运算， 得出来的结果 就是每个ip的网段

				与 AND 
				或 OR

				A 0	 1	1	0	0	1	0	0  = 100 
			mask  1	 0	0	0	0	0	0	0	
			 and  0	 0	0	0	0	0	0	0 = 0 

			 	B 1	 0	0	0	0	0	1	0 = 130 	
			mask  1	 0	0	0	0	0	0	0	
			adn   1	 0	0	0	0	0	0	0  = 128 


			A 193.100.100.100 是属于193.100.100.0 ， 1-127 
				0不能用，1-126， 127是广播
			B 193.100.100.130 是属于193.100.100.128 ， 128-255
				128-254， 255


			网关
				路由器的作用是负责 不同网段的数据转发
				路由器每个口都是连通一个网段， 一般企业路由器有2个口


			arp 协议 

				张家村长，必须要知道 张三炮的mac地址， 

				1. 村长 发了一个广播包，包含了 源ip, 源mac, 目标ip ,目标mac?为空
				2. 整个网段的机器都收到了这条消息，解析，检查这个包里的目标ip是不是跟本机的ip相同， 如果不同， 则丢弃。 如果相同， 响会响应一个包，响应包里，包含自己的ip+mac, 这个包会以单播发送给源地址
				3. 当村长收到响应包之后，打开，提取出里边的mac, 然后把 张3炮的IP+mac 存在本地的小本本上。 


				找到IP地址和mac地址的映射关系 ，因为在局域网通信 属于数据链路层，交换机不认识ip ，只认识mac。


				本地的小本本是什么？ 
					arp 表， 缓存表 
					每次发消息给三炮，先查arp表， 如果已经有ip+mac的映射关系 ，则直接 发送。 

					每个3层的网络设备，都有arp 表， 
					思科 默认 是5分钟， 华为20分， 
					windows 2分钟

					arp 纪录 老化时间

					为什么arp需要定时过期？ 

						arp 攻击
							中间人攻击
							泛洪攻击，IP 层广播风暴，网络拥堵，
							网关攻击
						解决攻击的方式：
							dhcp , ip 地址分配服务 器
							本机绑定静态的arp表


				路由表
					纪录着到其它网段的路径
				路由协议 


				IP 包头


			传输层
				链路层，定义 了主机的身份，mac地址，网络层定义 了ip ,有了这2个地址，
				数据包就可以从一台主机，发到另外一台主机了。 实际 上你的数据包，是从主机上的某个应用程序发出来的， 然后由对方主机的某个应用程序接收 的。 

				而每台电脑 同时可以运行多个应用程序 。 你的消息发到对方电脑上， 对方的电脑 怎么知道 要由哪个应用程序 来接收的你的消息呢？ 

				IP + 端口 可以标识一个网络程序 
					固定协议的端口
					http 80 
					dns 53 
					smtp 25 
					pop3 ..
					ftp 21/20
					ssh 22 

					mysql 3306 
					rdp 389 

					ssl 443 

				你自己写的程序 ， 不要用1000以下的。 


				udp 
					不可靠传输协议 
					只管发， 不管对方有没有收到 ， 没有确认机制 。 
					直播 

					面向报文的协议 ，不需要提前建立连接 ，直接给对方发数据 

				tcp 
					可靠传输协议 
					3次握手——》建立连接 
					4次挥手--》断开连接


			应用层
				先贤们开发了很多通用的应用协议 ，如ftp, ssh , dns, smtp 
				http . 
				



socket 网络 编程

套接字地址簇分类

SOCKET工作流程

socket 模块编程各参数介绍 

基于tcp 协议 的socket 开发

开发简单的ssh 远程命令执行工具

服务器间实现文件传送

粘包问题解决

像迅雷下载一样带下载进度条功能 

基于udp 协议 的socket 开发

批量给很多服务器发指令 

基于udp 开发一个聊天室原理介绍 



